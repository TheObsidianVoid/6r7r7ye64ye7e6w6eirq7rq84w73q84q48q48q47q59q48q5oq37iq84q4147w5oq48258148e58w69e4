<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TheObsidianVoid's Injector panel</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #333; color: #eee; }
        #controls { margin-bottom: 15px; padding: 10px; border: 1px solid #555; background-color: #222; border-radius: 5px; }
        #urlInput, #scriptInput, #htmlInput { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; background-color: #444; border: 1px solid #555; color: #eee; }
        button { padding: 10px 15px; margin-top: 10px; border: none; cursor: pointer; border-radius: 5px; color: white; }
        #loadButton { background-color: #d9534f; }
        #executeButton { background-color: #007bff; }
        #injectHtmlButton { background-color: #5cb85c; }
        label { display: block; margin-top: 10px; font-weight: bold; }
        textarea { font-family: monospace; }
        #status { margin-top: 20px; color: #ffeb3b; font-weight: bold; }
    </style>
</head>
<body>
    <div id="controls">
        <h2>Load Page</h2><h200>*some kinda proxy I forgor what kind</h200>
        <p>The target page will open in a separate, stylish window.</p>
        <label for="urlInput">Enter URL (e.g., https://www.example.com)</label>
        <input type="text" id="urlInput" value="https://www.example.com" placeholder="URL to load">
        <button id="loadButton">Open Proxied Window</button>

        <hr>

        <h2>Inject HTML Content</h2>
        <label for="htmlInput">Enter HTML Payload (Inserted at top of body):</label>
        <textarea id="htmlInput" rows="5" placeholder="<div style='color: white; background: green; padding: 10px;'>NEW HTML HERE</div>"></textarea>
        <button id="injectHtmlButton">Inject HTML</button>
        
        <hr>

        <h2>Inject JavaScript</h2>
        <label for="scriptInput">Enter Client-Side Script:</label>
        <textarea id="scriptInput" rows="5" placeholder="console.log('scripting is pain!'); document.body.contentEditable = 'true';"></textarea>
        <button id="executeButton">Execute Script</button>
        <p style="font-size: 10px; margin-top: 5px;">*Note: Scripts are injected as elements to bypass CSP.</p>
    </div>
    
    <div id="status">Status: Control Panel Loaded.</div>

    <script>
        const urlInput = document.getElementById('urlInput');
        const loadButton = document.getElementById('loadButton');
        const executeButton = document.getElementById('executeButton');
        const scriptInput = document.getElementById('scriptInput');
        const htmlInput = document.getElementById('htmlInput');
        const injectHtmlButton = document.getElementById('injectHtmlButton');
        const statusDiv = document.getElementById('status');

        let proxiedWindow = null;
        
        // --- CORE PERSISTENT FUNCTIONS ---

        // 1. CLOAKER FUNCTION
        function gcloak() { 
            if (!proxiedWindow || proxiedWindow.closed || !proxiedWindow.document || !proxiedWindow.document.head) {
                if (window.proxyInterval) clearInterval(window.proxyInterval);
                return;
            }
            
            const doc = proxiedWindow.document;
            var link = doc.querySelector("link[rel*='icon']") || doc.createElement('link');
            link.type = 'image/x-icon';
            link.rel = 'shortcut icon';
            link.href = 'https://www.pngall.com/wp-content/uploads/9/Google-Drive-Logo-Transparent-180x180.png';
            doc.title = 'My Drive - Google Drive';
            doc.getElementsByTagName('head')[0].appendChild(link);
        };

        // 2. PERSISTENT PROXY REWRITER FUNCTION
        function persistentProxy() {
            if (!proxiedWindow || proxiedWindow.closed || !proxiedWindow.document) return;

            const doc = proxiedWindow.document;
            const currentTargetUrl = new URL(proxiedWindow.location.search, window.location.origin).searchParams.get('target');
            if (!currentTargetUrl) return;

            // Rewriting links (anchor tags)
            doc.querySelectorAll('a').forEach(link => {
                const href = link.getAttribute('href');
                if (href && !href.startsWith('mailto:') && !href.startsWith('javascript:')) {
                    let absoluteUrl;
                    
                    try {
                        absoluteUrl = new URL(href, currentTargetUrl).href;
                    } catch (e) {
                        return;
                    }

                    // VERCEL PATH: Points to /api/proxy
                    link.setAttribute('href', '/api/proxy?target=' + encodeURIComponent(absoluteUrl));
                }
            });
            
            // Rewriting form actions
            doc.querySelectorAll('form').forEach(form => {
                 const action = form.getAttribute('action');
                 if (action) {
                     let absoluteAction;
                     
                     try {
                          absoluteAction = new URL(action, currentTargetUrl).href;
                     } catch (e) {
                          return;
                     }
                     
                     // VERCEL PATH: Points to /api/proxy
                     form.setAttribute('action', '/api/proxy?target=' + encodeURIComponent(absoluteAction));
                 }
            });
        }
        // ----------------------------------------

        // Function to load the URL in a new pop-up window
        loadButton.addEventListener('click', () => {
            let url = urlInput.value.trim();
            if (!url.startsWith('http')) {
                url = 'https://' + url;
            }
            
            // VERCEL PATH: Points to /api/proxy
            const proxyUrl = '/api/proxy?target=' + encodeURIComponent(url); 
            proxiedWindow = window.open(proxyUrl, 'ProxiedWindow', 'width=1200,height=800,resizable=yes,scrollbars=yes');
            
            if (proxiedWindow) {
                statusDiv.textContent = 'Status: Pop-up requested. Injection enabled immediately.';
                
                // *** AGGRESSIVE CLOAKER & PROXY START ***
                if (window.proxyInterval) clearInterval(window.proxyInterval);
                
                window.proxyInterval = setInterval(() => {
                    gcloak();
                    persistentProxy(); 
                }, 100); 
                // *** END AGGRESSIVE START ***

            } else {
                alert('Pop-up window was blocked! Check your browser settings.');
            }
        });

        // Function to execute the JavaScript (CSP BYPASS VERSION)
        executeButton.addEventListener('click', () => {
            if (!proxiedWindow || proxiedWindow.closed || !proxiedWindow.document || !proxiedWindow.document.head) {
                return alert('Pop-up window is not open or not ready for injection!');
            }
            
            const script = scriptInput.value;
            const iframeDocument = proxiedWindow.document;

            try {
                const newScript = iframeDocument.createElement('script');
                newScript.textContent = script;
                
                iframeDocument.head.appendChild(newScript); 
                newScript.remove(); // Clean up

                console.log('Script executed successfully! CSP defeated by injection!');
                statusDiv.textContent = 'Status: JS Executed.';
            } catch (error) {
                console.error('You fucked up, error injecting script:', error);
                alert('Fucking injection error: ' + error.message);
            }
        });

        // Function to execute the HTML Injection
        injectHtmlButton.addEventListener('click', () => {
            if (!proxiedWindow || proxiedWindow.closed || !proxiedWindow.document || !proxiedWindow.document.body) {
                return alert('Pop-up window is not open or not ready for injection!');
            }
            
            const htmlPayload = htmlInput.value;
            const iframeDocument = proxiedWindow.document;

            try {
                iframeDocument.body.insertAdjacentHTML('afterbegin', htmlPayload);
                console.log('HTML payload successfully injected into the target page!');
                statusDiv.textContent = 'Status: HTML Injected.';
            } catch (error) {
                console.error('Fucking error injecting HTML:', error);
                alert('Error injecting HTML: ' + error.message);
            }
        });
    </script>
</body>
</html>
